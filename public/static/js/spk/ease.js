/* * Ease * (c) 2013 Sparkida * Author: Nicholas Riley * v 0.56 */Spk.extend('ease',function(){var dc=null,dd=void 0;"use strict";var e=function(a,b,c,d){return ease(a,b,c,d)},g={},h=function(x){return'alpha(opacity='+x+')';},j=Spk.ieVersion,k=Spk.browser,l=Spk.getStyle,ease=(function(){var m=46,o='linear',p=function(q){return(q.toString()!=='NaN')?Number(q)||0:0},r={'linear':function(d,c,f,s){return d*(c/f)+s},'easeInStrong':function(d,c,f,s){return(Math.pow(c/f,4)*d)+s},'easeOutStrong':function(d,c,f,s){return 1-(Math.pow(c/f,5)*d)+s},'easeInOutQuad':function(d,c,f,s){if((c/=f/2)<1){return d/2*c*c+s}return-d/2*((--c)*(c-2)-1)+s}},u=(function(){var v=function(id,w,y){var z=g[id],A=z.props[w];if(dd!=y&&y){for(var i=0;i<A.timers.length;i++){Spk.win.clearTimeout(A.timers[i])}}A.frames=0,A.currentFrame=0,A.rate=0,A.active=!1};return function(id,w,y){if(dd!=id&&id instanceof Array){for(var i=0;i<id.length;i++){v(id[i],w,y)}}else{v(id,w,y)}}})(),B={},C=(function(){var ease=function(id,w){var z=g[id],A=z.props[w],D=w=='opacity'?'':'px';Spk.win.clearTimeout(A.timers[A.currentFrame]);if(A.currentFrame<A.frames){for(var t=0;t<z.target.length;t++){if(w==='opacity'&&k==='msie'&&j<9){z.target[t].style['filter']='alpha(opacity='+r[z.easeType](A.dist[t],A.currentFrame,A.frames,A.start[t])+')';}else{switch(w){case'backgroundColor':case'color':case'borderColor':var E=[];for(var i=0;i<A.start[t].length;i++){var q=Math.round(r[z.easeType](Number(A.dist[t][i]),A.currentFrame,A.frames,Number(A.start[t][i])));E.push(q);}z.target[t].style[w]='rgb('+E.join(',')+')';break;default:z.target[t].style[w]=r[z.easeType](A.dist[t],A.currentFrame,A.frames,A.start[t])+D}}}A.currentFrame++;}else{A.active=!1;for(var i=0;i<z.target.length;i++){if(w==='opacity'&&k==='msie'&&j<9){z.target[i].style['filter']='alpha(opacity='+A.end[i]+')';}else{switch(w){case'backgroundColor':case'color':case'borderColor':if(z.colors[w][i].remove&&z.rewindUsed){z.target[i].style[w]=dc}else{z.target[i].style[w]='rgb('+A.end[i].join(',')+')';}break;default:z.target[i].style[w]=A.end[i]+D}}}if(A.sync.length>1){for(var i=0;i<A.sync.length;i++){var F=A.sync[i];if(z.props[F].active){u(id,w);return;}}}z.active=!1;if(dd!=z.complete&&z.complete!=dc){switch(typeof z.complete){case'function':u(id,w);if(z.isArray){z.complete.call(z.target)}else{z.complete.call(z.target[0])}break;case'string':switch(z.complete){case'rewind':var G=A.sync;u(z.id,w),z.complete=dc,z.active=!0,z.rewindUsed=!0,z.startTime=Spk.benchmark();for(var i=0;i<A.sync.length;i++){var F=A.sync[i],H=z.props[F];for(var t=0;t<z.target.length;t++){var I=H.start[t];H.start[t]=H.end[t],H.end[t]=z.colors[F][t].changeValue;if(z.hasColors){for(var d=0;d<H.dist[t].length;d++){H.dist[t][d]=-H.dist[t][d]}}else{H.dist[t]=-H.dist[t];}}buildTween(z.id,F);}return;break;}break;}}g[id]=dc;delete g[id]}},buildTween=function(id,w){var z=g[id],A=z.props[w],J=function(){ease(id,w)};A.active=!0;A.frames=Math.round(g[id].fps*z.time/1000),A.timers=[],A.frames=A.frames>0?A.frames:1;for(var K=0;K<A.frames+1;K++){var L=Spk.benchmark()-z.startTime;A.rate=(K/A.frames)*(z.time);A.timers.push(Spk.win.setTimeout(J,A.rate-L))}},M=function(id,w){var z=g[id],N=z.startTime,O=Spk.benchmark(),P=O-N,Q=z.delay?z.delay-P:0;if(Q>0){var R=function(){buildTween(id,w)};z.startTime+=Q;B[id]=Spk.win.setTimeout(R,Q)}else{buildTween(id,w)}};return function(id,S){var G=[];for(var n in S){G.push(n);g[id].props[n].sync=G,M(id,n)}}})(),T=(function(){var U={active:!1,start:[],end:[],dist:[],frames:0,currentFrame:0,rate:0,sync:[]};return function(){return Spk.objectClone(U);}})(),aa=(function(){var ab=['start','end','dist'];return function(id,w,ac){var z=g[id],A=z.props[w],O=z.time;ac.push(O);for(var i=0;i<ab.length;i++){A[ab[i]]=ac[i]}}})(),ad=function(id,w){if(dd===g[id].props[w]){var ae=T();g[id].props[w]=ae,g[id].props[w].prop=w}},ac={},af=function(id){for(var n in ac){g[id][n]=ac[n]}ac={}},ag=(function(){var id=0;return function(ah,O){this.id=id++,this.target=ah,this.time=O,this.props={},this.isArray=!1,this.rewindUsed=!1,this.colors={},this.hasColors=!1,this.startTime=Spk.benchmark()}})();ag.prototype.easeType='easeInOutQuad';ag.prototype.fps=m;return function(ah,O,ai,aj){var ah,ai,O,ak=!1;if(typeof ah!='object'){throw'Invalid ease target object'}if(typeof O!='number'){throw'Invalid ease time'}if(typeof ai!='object'){throw'Invalid ease properties'}if(ah instanceof Array){ak=!0}else if(typeof ah==='object'&&dd===ah.nodeType){ak=!0,ah=Spk.objectArray(ah)}else{ah=[ah]}for(var i=0;i<ah.length;i++){if(ah[i]instanceof Array){var d=ah[i];ah.splice(i,1);ah=ah.concat(d);}else if(typeof ah[i]==='object'&&dd===ah[i].nodeType){var d=ah[i];ah.splice(i,1);ah=ah.concat(Spk.objectArray(d));}}var z=new ag(ah,O),id=z.id;z.isArray=ak;g[id]=z,z.easeType=(dd!=aj&&dd!=r[aj])?aj:o;for(var w in ai){var al='';switch(w){case'onComplete':w='complete';al='onComplete';ac[w]=ai[al],ai[al]=dc;delete ai[al];break;case'complete':case'delay':ac[w]=ai[w],ai[w]=dc;delete ai[w];break;}}af(id);for(var w in ai){var V=[],W=[],I=[],am=dd==ai[w].length&&typeof ai[w]=='number';if(!am&&!ai[w].length){throw'Invalid ease property '+w+' : '+ai[w];}switch(w){case'background':var an=ai[w];ai[w]=dc;delete ai[w];w='backgroundColor';ai[w]=an;case'backgroundColor':case'color':case'borderColor':case'borderTopColor':case'borderRightColor':case'borderBottomColor':case'borderLeftColor':if(!z.hasColors){z.hasColors=!0}ad(id,w);var ao=ai[w].substr(0,1)==='#'?Spk.getRGB(ai[w]):ai[w].match(/[0-9]{1,3}/g);for(var i=0;i<ah.length;i++){I[i]=ao;W[i]=[];V[i]=ah[i].style[w].length?ah[i].style[w]:l(w,ah[i]);if(dd===z.colors[w]){z.colors[w]={}}V[i]=V[i].substr(0,1)==='#'?Spk.getRGB(V[i]):V[i].match(/[0-9]{1,3}/g);z.colors[w][i]={remove:ah[i].style[w].length>0?!1:!0,changeValue:V[i]};for(var s=0;s<V[i].length;s++){W[i][s]=parseInt(I[i][s]-V[i][s]);}}break;case'width':case'height':var aq='offset';aq+=w=='width'?'Width':'Height';for(var i=0;i<ah.length;i++){ah[i].style[w]=ah[i][aq]+'px';}case'left':case'right':case'top':case'bottom':case'margin':case'marginTop':case'marginRight':case'marginBottom':case'marginLeft':ad(id,w);for(var i=0;i<ah.length;i++){V[i]=parseFloat(ah[i].style[w])||0;I[i]=am?V[i]+ai[w]:parseFloat(ai[w]);if(I[i]<0&&(w==='width'||w==='height')){I[i]=0}W[i]=I[i]-V[i];}break;case'opacity':var ar=parseFloat(ai[w]);ad(id,w);for(var i=0;i<ah.length;i++){if(k=='msie'&&j<9){V[i]=l(w,ah[i]).length?parseFloat(ah[i].style[w]):100;}else{I[i]=ar;V[i]=(ah[i].style[w].length)?parseFloat(ah[i].style[w])||0:parseFloat(l(w,ah[i]));}W[i]=I[i]-V[i];}break;default:throw'Invalid ease property '+w+' : '+ai[w];}aa(id,w,[V,I,W]);}C(id,ai);return id}})();e.fadeIn=(function(){var O=350,as='linear',at,au=function(av){var aw=av.style.visibility||Spk.getStyle('visibility',av),ax=(aw!=='hidden'),ay=av.style.display||Spk.getStyle('display',av),az=(ay!=='none'),da={opacity:0};if(!ax){da.visibility='visible'}if(!az){da.display='block'}Spk.style(av,da);};return function(av,O,as,at){if(av instanceof Array){for(var i=0;i<av.length;i++){au(av[i])}}else{au(av)}if(O instanceof Array&&O.length===2){ease(av,O[0],{opacity:1,delay:O[1],complete:at},as);return}ease(av,O,{opacity:1,complete:at},as)}})(),e.fadeOut=(function(){var O=350,as='linear',at;return function(av,O,as,at){var at=dd===at?function(){Spk.style(this,{display:'none'})}:function(){Spk.style(this,{display:'none'}),at()};if(O instanceof Array&&O.length===2){ease(av,O[0],{opacity:0,delay:O[1],complete:at},as);return}ease(av,O,{opacity:0,complete:at},as)}})();return e});